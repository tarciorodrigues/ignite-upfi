{"ast":null,"code":"import _defineProperty from \"/Users/tarciorodrigues/Documents/workspace/rocketseat/ignite/ReactJS/ignite-aulas/reactjs/ignite-upfi/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport _regeneratorRuntime from \"/Users/tarciorodrigues/Documents/workspace/rocketseat/ignite/ReactJS/ignite-aulas/reactjs/ignite-upfi/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/tarciorodrigues/Documents/workspace/rocketseat/ignite/ReactJS/ignite-aulas/reactjs/ignite-upfi/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _objectWithoutProperties from \"/Users/tarciorodrigues/Documents/workspace/rocketseat/ignite/ReactJS/ignite-aulas/reactjs/ignite-upfi/node_modules/next/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties\";\n\nvar _jsxFileName = \"/Users/tarciorodrigues/Documents/workspace/rocketseat/ignite/ReactJS/ignite-aulas/reactjs/ignite-upfi/src/components/Input/FileInput.tsx\",\n    _this = this,\n    _s = $RefreshSig$();\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { Box, FormLabel, CircularProgress, CircularProgressLabel, Icon, Image, Text, FormControl, FormErrorMessage, Flex, useToast, Tooltip } from '@chakra-ui/react';\nimport axios from 'axios';\nimport { useState, forwardRef, useCallback, useEffect } from 'react';\nimport { FiAlertCircle, FiPlus } from 'react-icons/fi';\nimport { api } from '../../services/api';\n\nvar FileInputBase = function FileInputBase(_ref, ref) {\n  _s();\n\n  var name = _ref.name,\n      _ref$error = _ref.error,\n      error = _ref$error === void 0 ? null : _ref$error,\n      setImageUrl = _ref.setImageUrl,\n      localImageUrl = _ref.localImageUrl,\n      setLocalImageUrl = _ref.setLocalImageUrl,\n      setError = _ref.setError,\n      onChange = _ref.onChange,\n      trigger = _ref.trigger,\n      rest = _objectWithoutProperties(_ref, [\"name\", \"error\", \"setImageUrl\", \"localImageUrl\", \"setLocalImageUrl\", \"setError\", \"onChange\", \"trigger\"]);\n\n  var toast = useToast();\n\n  var _useState = useState(0),\n      progress = _useState[0],\n      setProgress = _useState[1];\n\n  var _useState2 = useState(false),\n      isSending = _useState2[0],\n      setIsSending = _useState2[1];\n\n  var _useState3 = useState({}),\n      cancelToken = _useState3[0],\n      setCancelToken = _useState3[1];\n\n  var handleImageUpload = useCallback( /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(event) {\n      var _event$target$files;\n\n      var formData, CancelToken, source, config, response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if ((_event$target$files = event.target.files) !== null && _event$target$files !== void 0 && _event$target$files.length) {\n                _context.next = 2;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 2:\n              setImageUrl('');\n              setLocalImageUrl('');\n              setError('image', null);\n              setIsSending(true);\n              _context.next = 8;\n              return onChange(event);\n\n            case 8:\n              trigger('image');\n              formData = new FormData();\n              formData.append(event.target.name, event.target.files[0]);\n              formData.append('key', process.env.NEXT_PUBLIC_IMGBB_API_KEY);\n              CancelToken = axios.CancelToken;\n              source = CancelToken.source();\n              setCancelToken(source);\n              config = {\n                headers: {\n                  'content-type': 'multipart/form-data'\n                },\n                onUploadProgress: function onUploadProgress(e) {\n                  setProgress(Math.round(e.loaded * 100 / e.total));\n                },\n                cancelToken: source.token\n              };\n              _context.prev = 16;\n              _context.next = 19;\n              return api.post('https://api.imgbb.com/1/upload', formData, config);\n\n            case 19:\n              response = _context.sent;\n              setImageUrl(response.data.data.url);\n              setLocalImageUrl(URL.createObjectURL(event.target.files[0]));\n              _context.next = 29;\n              break;\n\n            case 24:\n              _context.prev = 24;\n              _context.t0 = _context[\"catch\"](16);\n\n              if (!((_context.t0 === null || _context.t0 === void 0 ? void 0 : _context.t0.message) === 'Cancelled image upload.')) {\n                _context.next = 28;\n                break;\n              }\n\n              return _context.abrupt(\"return\");\n\n            case 28:\n              toast({\n                title: 'Falha no envio',\n                description: 'Ocorreu um erro ao realizar o upload da sua imagem.',\n                status: 'error',\n                duration: 5000,\n                isClosable: true\n              });\n\n            case 29:\n              _context.prev = 29;\n              setIsSending(false);\n              setProgress(0);\n              return _context.finish(29);\n\n            case 33:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[16, 24, 29, 33]]);\n    }));\n\n    return function (_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }(), [onChange, setError, setImageUrl, setLocalImageUrl, trigger, toast]);\n  useEffect(function () {\n    if (error !== null && error !== void 0 && error.message && isSending && cancelToken !== null && cancelToken !== void 0 && cancelToken.cancel) {\n      cancelToken.cancel('Cancelled image upload.');\n      setCancelToken(null);\n    }\n  }, [cancelToken, error, isSending]);\n  return /*#__PURE__*/_jsxDEV(FormControl, {\n    isInvalid: !!error,\n    children: /*#__PURE__*/_jsxDEV(FormLabel, {\n      mx: \"auto\",\n      w: 40,\n      h: 40,\n      htmlFor: name,\n      cursor: isSending ? 'progress' : 'pointer',\n      opacity: isSending ? 0.5 : 1,\n      children: [localImageUrl && !isSending ? /*#__PURE__*/_jsxDEV(Image, {\n        w: \"full\",\n        h: \"full\",\n        src: localImageUrl,\n        alt: \"Uploaded photo\",\n        borderRadius: \"md\",\n        objectFit: \"cover\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 11\n      }, _this) : /*#__PURE__*/_jsxDEV(Flex, {\n        w: \"full\",\n        h: \"full\",\n        flexDir: \"column\",\n        justifyContent: \"center\",\n        alignItems: \"center\",\n        borderRadius: \"md\",\n        bgColor: \"pGray.800\",\n        color: \"pGray.200\",\n        borderWidth: (error === null || error === void 0 ? void 0 : error.message) && 2,\n        borderColor: (error === null || error === void 0 ? void 0 : error.message) && 'red.500',\n        children: isSending ? /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(CircularProgress, {\n            trackColor: \"pGray.200\",\n            value: progress,\n            color: \"orange.500\",\n            children: /*#__PURE__*/_jsxDEV(CircularProgressLabel, {\n              children: [progress, \"%\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 175,\n              columnNumber: 19\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 17\n          }, _this), /*#__PURE__*/_jsxDEV(Text, {\n            as: \"span\",\n            pt: 2,\n            textAlign: \"center\",\n            children: \"Enviando...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 17\n          }, _this)]\n        }, void 0, true) : /*#__PURE__*/_jsxDEV(Box, {\n          pos: \"relative\",\n          h: \"full\",\n          children: [!!error && /*#__PURE__*/_jsxDEV(Tooltip, {\n            label: error.message,\n            bg: \"red.500\",\n            children: /*#__PURE__*/_jsxDEV(FormErrorMessage, {\n              pos: \"absolute\",\n              right: 2,\n              top: 2,\n              mt: 0,\n              zIndex: \"tooltip\",\n              children: /*#__PURE__*/_jsxDEV(Icon, {\n                as: FiAlertCircle,\n                color: \"red.500\",\n                w: 4,\n                h: 4\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 192,\n                columnNumber: 23\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 21\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 19\n          }, _this), /*#__PURE__*/_jsxDEV(Flex, {\n            h: \"full\",\n            alignItems: \"center\",\n            justifyContent: \"center\",\n            flexDir: \"column\",\n            children: [/*#__PURE__*/_jsxDEV(Icon, {\n              as: FiPlus,\n              w: 14,\n              h: 14\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 203,\n              columnNumber: 19\n            }, _this), /*#__PURE__*/_jsxDEV(Text, {\n              as: \"span\",\n              pt: 2,\n              textAlign: \"center\",\n              children: \"Adicione sua imagem\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 204,\n              columnNumber: 19\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 197,\n            columnNumber: 17\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 182,\n          columnNumber: 15\n        }, _this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 11\n      }, _this), /*#__PURE__*/_jsxDEV(\"input\", _objectSpread({\n        \"data-testid\": name,\n        disabled: isSending,\n        id: name,\n        name: name,\n        onChange: handleImageUpload,\n        ref: ref,\n        type: \"file\",\n        style: {\n          display: 'none'\n        }\n      }, rest), void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }, _this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }, _this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(FileInputBase, \"P2ojDRhaBIFg4Vr8sEH9T9ZVjvQ=\", false, function () {\n  return [useToast];\n});\n\n_c = FileInputBase;\nexport var FileInput = /*#__PURE__*/forwardRef(FileInputBase);\n_c2 = FileInput;\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"FileInputBase\");\n$RefreshReg$(_c2, \"FileInput\");","map":{"version":3,"sources":["/Users/tarciorodrigues/Documents/workspace/rocketseat/ignite/ReactJS/ignite-aulas/reactjs/ignite-upfi/src/components/Input/FileInput.tsx"],"names":["Box","FormLabel","CircularProgress","CircularProgressLabel","Icon","Image","Text","FormControl","FormErrorMessage","Flex","useToast","Tooltip","axios","useState","forwardRef","useCallback","useEffect","FiAlertCircle","FiPlus","api","FileInputBase","ref","name","error","setImageUrl","localImageUrl","setLocalImageUrl","setError","onChange","trigger","rest","toast","progress","setProgress","isSending","setIsSending","cancelToken","setCancelToken","handleImageUpload","event","target","files","length","formData","FormData","append","process","env","NEXT_PUBLIC_IMGBB_API_KEY","CancelToken","source","config","headers","onUploadProgress","e","Math","round","loaded","total","token","post","response","data","url","URL","createObjectURL","message","title","description","status","duration","isClosable","cancel","display","FileInput"],"mappings":";;;;;;;;;;;;;;;AAAA,SACEA,GADF,EAEEC,SAFF,EAGEC,gBAHF,EAIEC,qBAJF,EAKEC,IALF,EAMEC,KANF,EAOEC,IAPF,EAQEC,WARF,EASEC,gBATF,EAUEC,IAVF,EAWEC,QAXF,EAYEC,OAZF,QAaO,kBAbP;AAcA,OAAOC,KAAP,MAA6D,OAA7D;AACA,SACEC,QADF,EAKEC,UALF,EAMEC,WANF,EAOEC,SAPF,QAQO,OARP;AAeA,SAASC,aAAT,EAAwBC,MAAxB,QAAsC,gBAAtC;AACA,SAASC,GAAT,QAAoB,oBAApB;;AAeA,IAAMC,aAGL,GAAG,SAHEA,aAGF,OAYFC,GAZE,EAaC;AAAA;;AAAA,MAXDC,IAWC,QAXDA,IAWC;AAAA,wBAVDC,KAUC;AAAA,MAVDA,KAUC,2BAVO,IAUP;AAAA,MATDC,WASC,QATDA,WASC;AAAA,MARDC,aAQC,QARDA,aAQC;AAAA,MAPDC,gBAOC,QAPDA,gBAOC;AAAA,MANDC,QAMC,QANDA,QAMC;AAAA,MALDC,QAKC,QALDA,QAKC;AAAA,MAJDC,OAIC,QAJDA,OAIC;AAAA,MAHEC,IAGF;;AACH,MAAMC,KAAK,GAAGrB,QAAQ,EAAtB;;AADG,kBAE6BG,QAAQ,CAAC,CAAD,CAFrC;AAAA,MAEImB,QAFJ;AAAA,MAEcC,WAFd;;AAAA,mBAG+BpB,QAAQ,CAAC,KAAD,CAHvC;AAAA,MAGIqB,SAHJ;AAAA,MAGeC,YAHf;;AAAA,mBAImCtB,QAAQ,CAC5C,EAD4C,CAJ3C;AAAA,MAIIuB,WAJJ;AAAA,MAIiBC,cAJjB;;AAQH,MAAMC,iBAAiB,GAAGvB,WAAW;AAAA,yEACnC,iBAAOwB,KAAP;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yCACOA,KAAK,CAACC,MAAN,CAAaC,KADpB,gDACO,oBAAoBC,MAD3B;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAKElB,cAAAA,WAAW,CAAC,EAAD,CAAX;AACAE,cAAAA,gBAAgB,CAAC,EAAD,CAAhB;AACAC,cAAAA,QAAQ,CAAC,OAAD,EAAU,IAAV,CAAR;AACAQ,cAAAA,YAAY,CAAC,IAAD,CAAZ;AARF;AAAA,qBAUQP,QAAQ,CAACW,KAAD,CAVhB;;AAAA;AAWEV,cAAAA,OAAO,CAAC,OAAD,CAAP;AAEMc,cAAAA,QAbR,GAamB,IAAIC,QAAJ,EAbnB;AAeED,cAAAA,QAAQ,CAACE,MAAT,CAAgBN,KAAK,CAACC,MAAN,CAAalB,IAA7B,EAAmCiB,KAAK,CAACC,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAAnC;AACAE,cAAAA,QAAQ,CAACE,MAAT,CAAgB,KAAhB,EAAuBC,OAAO,CAACC,GAAR,CAAYC,yBAAnC;AAEQC,cAAAA,WAlBV,GAkB0BrC,KAlB1B,CAkBUqC,WAlBV;AAmBQC,cAAAA,MAnBR,GAmBiBD,WAAW,CAACC,MAAZ,EAnBjB;AAoBEb,cAAAA,cAAc,CAACa,MAAD,CAAd;AAEMC,cAAAA,MAtBR,GAsBiB;AACbC,gBAAAA,OAAO,EAAE;AAAE,kCAAgB;AAAlB,iBADI;AAEbC,gBAAAA,gBAAgB,EAAE,0BAACC,CAAD,EAAsB;AACtCrB,kBAAAA,WAAW,CAACsB,IAAI,CAACC,KAAL,CAAYF,CAAC,CAACG,MAAF,GAAW,GAAZ,GAAmBH,CAAC,CAACI,KAAhC,CAAD,CAAX;AACD,iBAJY;AAKbtB,gBAAAA,WAAW,EAAEc,MAAM,CAACS;AALP,eAtBjB;AAAA;AAAA;AAAA,qBA+B2BxC,GAAG,CAACyC,IAAJ,CACrB,gCADqB,EAErBjB,QAFqB,EAGrBQ,MAHqB,CA/B3B;;AAAA;AA+BUU,cAAAA,QA/BV;AAqCIrC,cAAAA,WAAW,CAACqC,QAAQ,CAACC,IAAT,CAAcA,IAAd,CAAmBC,GAApB,CAAX;AACArC,cAAAA,gBAAgB,CAACsC,GAAG,CAACC,eAAJ,CAAoB1B,KAAK,CAACC,MAAN,CAAaC,KAAb,CAAmB,CAAnB,CAApB,CAAD,CAAhB;AAtCJ;AAAA;;AAAA;AAAA;AAAA;;AAAA,oBAwCQ,uEAAKyB,OAAL,MAAiB,yBAxCzB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AA0CInC,cAAAA,KAAK,CAAC;AACJoC,gBAAAA,KAAK,EAAE,gBADH;AAEJC,gBAAAA,WAAW,EAAE,qDAFT;AAGJC,gBAAAA,MAAM,EAAE,OAHJ;AAIJC,gBAAAA,QAAQ,EAAE,IAJN;AAKJC,gBAAAA,UAAU,EAAE;AALR,eAAD,CAAL;;AA1CJ;AAAA;AAkDIpC,cAAAA,YAAY,CAAC,KAAD,CAAZ;AACAF,cAAAA,WAAW,CAAC,CAAD,CAAX;AAnDJ;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KADmC;;AAAA;AAAA;AAAA;AAAA,OAuDnC,CAACL,QAAD,EAAWD,QAAX,EAAqBH,WAArB,EAAkCE,gBAAlC,EAAoDG,OAApD,EAA6DE,KAA7D,CAvDmC,CAArC;AA0DAf,EAAAA,SAAS,CAAC,YAAM;AACd,QAAIO,KAAK,SAAL,IAAAA,KAAK,WAAL,IAAAA,KAAK,CAAE2C,OAAP,IAAkBhC,SAAlB,IAA+BE,WAA/B,aAA+BA,WAA/B,eAA+BA,WAAW,CAAEoC,MAAhD,EAAwD;AACtDpC,MAAAA,WAAW,CAACoC,MAAZ,CAAmB,yBAAnB;AACAnC,MAAAA,cAAc,CAAC,IAAD,CAAd;AACD;AACF,GALQ,EAKN,CAACD,WAAD,EAAcb,KAAd,EAAqBW,SAArB,CALM,CAAT;AAOA,sBACE,QAAC,WAAD;AAAa,IAAA,SAAS,EAAE,CAAC,CAACX,KAA1B;AAAA,2BACE,QAAC,SAAD;AACE,MAAA,EAAE,EAAC,MADL;AAEE,MAAA,CAAC,EAAE,EAFL;AAGE,MAAA,CAAC,EAAE,EAHL;AAIE,MAAA,OAAO,EAAED,IAJX;AAKE,MAAA,MAAM,EAAEY,SAAS,GAAG,UAAH,GAAgB,SALnC;AAME,MAAA,OAAO,EAAEA,SAAS,GAAG,GAAH,GAAS,CAN7B;AAAA,iBAQGT,aAAa,IAAI,CAACS,SAAlB,gBACC,QAAC,KAAD;AACE,QAAA,CAAC,EAAC,MADJ;AAEE,QAAA,CAAC,EAAC,MAFJ;AAGE,QAAA,GAAG,EAAET,aAHP;AAIE,QAAA,GAAG,EAAC,gBAJN;AAKE,QAAA,YAAY,EAAC,IALf;AAME,QAAA,SAAS,EAAC;AANZ;AAAA;AAAA;AAAA;AAAA,eADD,gBAUC,QAAC,IAAD;AACE,QAAA,CAAC,EAAC,MADJ;AAEE,QAAA,CAAC,EAAC,MAFJ;AAGE,QAAA,OAAO,EAAC,QAHV;AAIE,QAAA,cAAc,EAAC,QAJjB;AAKE,QAAA,UAAU,EAAC,QALb;AAME,QAAA,YAAY,EAAC,IANf;AAOE,QAAA,OAAO,EAAC,WAPV;AAQE,QAAA,KAAK,EAAC,WARR;AASE,QAAA,WAAW,EAAE,CAAAF,KAAK,SAAL,IAAAA,KAAK,WAAL,YAAAA,KAAK,CAAE2C,OAAP,KAAkB,CATjC;AAUE,QAAA,WAAW,EAAE,CAAA3C,KAAK,SAAL,IAAAA,KAAK,WAAL,YAAAA,KAAK,CAAE2C,OAAP,KAAkB,SAVjC;AAAA,kBAYGhC,SAAS,gBACR;AAAA,kCACE,QAAC,gBAAD;AACE,YAAA,UAAU,EAAC,WADb;AAEE,YAAA,KAAK,EAAEF,QAFT;AAGE,YAAA,KAAK,EAAC,YAHR;AAAA,mCAKE,QAAC,qBAAD;AAAA,yBAAwBA,QAAxB;AAAA;AAAA;AAAA;AAAA;AAAA;AALF;AAAA;AAAA;AAAA;AAAA,mBADF,eAQE,QAAC,IAAD;AAAM,YAAA,EAAE,EAAC,MAAT;AAAgB,YAAA,EAAE,EAAE,CAApB;AAAuB,YAAA,SAAS,EAAC,QAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBARF;AAAA,wBADQ,gBAcR,QAAC,GAAD;AAAK,UAAA,GAAG,EAAC,UAAT;AAAoB,UAAA,CAAC,EAAC,MAAtB;AAAA,qBACG,CAAC,CAACT,KAAF,iBACC,QAAC,OAAD;AAAS,YAAA,KAAK,EAAEA,KAAK,CAAC2C,OAAtB;AAA+B,YAAA,EAAE,EAAC,SAAlC;AAAA,mCACE,QAAC,gBAAD;AACE,cAAA,GAAG,EAAC,UADN;AAEE,cAAA,KAAK,EAAE,CAFT;AAGE,cAAA,GAAG,EAAE,CAHP;AAIE,cAAA,EAAE,EAAE,CAJN;AAKE,cAAA,MAAM,EAAC,SALT;AAAA,qCAOE,QAAC,IAAD;AAAM,gBAAA,EAAE,EAAEjD,aAAV;AAAyB,gBAAA,KAAK,EAAC,SAA/B;AAAyC,gBAAA,CAAC,EAAE,CAA5C;AAA+C,gBAAA,CAAC,EAAE;AAAlD;AAAA;AAAA;AAAA;AAAA;AAPF;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,mBAFJ,eAeE,QAAC,IAAD;AACE,YAAA,CAAC,EAAC,MADJ;AAEE,YAAA,UAAU,EAAC,QAFb;AAGE,YAAA,cAAc,EAAC,QAHjB;AAIE,YAAA,OAAO,EAAC,QAJV;AAAA,oCAME,QAAC,IAAD;AAAM,cAAA,EAAE,EAAEC,MAAV;AAAkB,cAAA,CAAC,EAAE,EAArB;AAAyB,cAAA,CAAC,EAAE;AAA5B;AAAA;AAAA;AAAA;AAAA,qBANF,eAOE,QAAC,IAAD;AAAM,cAAA,EAAE,EAAC,MAAT;AAAgB,cAAA,EAAE,EAAE,CAApB;AAAuB,cAAA,SAAS,EAAC,QAAjC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAPF;AAAA;AAAA;AAAA;AAAA;AAAA,mBAfF;AAAA;AAAA;AAAA;AAAA;AAAA;AA1BJ;AAAA;AAAA;AAAA;AAAA,eAlBJ,eA0EE;AACE,uBAAaI,IADf;AAEE,QAAA,QAAQ,EAAEY,SAFZ;AAGE,QAAA,EAAE,EAAEZ,IAHN;AAIE,QAAA,IAAI,EAAEA,IAJR;AAKE,QAAA,QAAQ,EAAEgB,iBALZ;AAME,QAAA,GAAG,EAAEjB,GANP;AAOE,QAAA,IAAI,EAAC,MAPP;AAQE,QAAA,KAAK,EAAE;AACLoD,UAAAA,OAAO,EAAE;AADJ;AART,SAWM3C,IAXN;AAAA;AAAA;AAAA;AAAA,eA1EF;AAAA;AAAA;AAAA;AAAA;AAAA;AADF;AAAA;AAAA;AAAA;AAAA,WADF;AA4FD,CArLD;;GAAMV,a;UAiBUV,Q;;;KAjBVU,a;AAuLN,OAAO,IAAMsD,SAAS,gBAAG5D,UAAU,CAACM,aAAD,CAA5B;MAAMsD,S","sourcesContent":["import {\n  Box,\n  FormLabel,\n  CircularProgress,\n  CircularProgressLabel,\n  Icon,\n  Image,\n  Text,\n  FormControl,\n  FormErrorMessage,\n  Flex,\n  useToast,\n  Tooltip,\n} from '@chakra-ui/react';\nimport axios, { AxiosRequestConfig, CancelTokenSource } from 'axios';\nimport {\n  useState,\n  SetStateAction,\n  Dispatch,\n  ForwardRefRenderFunction,\n  forwardRef,\n  useCallback,\n  useEffect,\n} from 'react';\nimport {\n  FieldError,\n  FieldValues,\n  UseFormSetError,\n  UseFormTrigger,\n} from 'react-hook-form';\nimport { FiAlertCircle, FiPlus } from 'react-icons/fi';\nimport { api } from '../../services/api';\n\nexport interface FileInputProps {\n  name: string;\n  error?: FieldError;\n  setImageUrl: Dispatch<SetStateAction<string>>;\n  localImageUrl: string;\n  setLocalImageUrl: Dispatch<SetStateAction<string>>;\n  setError: UseFormSetError<FieldValues>;\n  onChange: (\n    event: React.ChangeEvent<HTMLInputElement>\n  ) => Promise<boolean | void>;\n  trigger: UseFormTrigger<FieldValues>;\n}\n\nconst FileInputBase: ForwardRefRenderFunction<\n  HTMLInputElement,\n  FileInputProps\n> = (\n  {\n    name,\n    error = null,\n    setImageUrl,\n    localImageUrl,\n    setLocalImageUrl,\n    setError,\n    onChange,\n    trigger,\n    ...rest\n  },\n  ref\n) => {\n  const toast = useToast();\n  const [progress, setProgress] = useState(0);\n  const [isSending, setIsSending] = useState(false);\n  const [cancelToken, setCancelToken] = useState<CancelTokenSource>(\n    {} as CancelTokenSource\n  );\n\n  const handleImageUpload = useCallback(\n    async (event: React.ChangeEvent<HTMLInputElement>): Promise<void> => {\n      if (!event.target.files?.length) {\n        return;\n      }\n\n      setImageUrl('');\n      setLocalImageUrl('');\n      setError('image', null);\n      setIsSending(true);\n\n      await onChange(event);\n      trigger('image');\n\n      const formData = new FormData();\n\n      formData.append(event.target.name, event.target.files[0]);\n      formData.append('key', process.env.NEXT_PUBLIC_IMGBB_API_KEY);\n\n      const { CancelToken } = axios;\n      const source = CancelToken.source();\n      setCancelToken(source);\n\n      const config = {\n        headers: { 'content-type': 'multipart/form-data' },\n        onUploadProgress: (e: ProgressEvent) => {\n          setProgress(Math.round((e.loaded * 100) / e.total));\n        },\n        cancelToken: source.token,\n      } as AxiosRequestConfig;\n\n      try {\n        const response = await api.post(\n          'https://api.imgbb.com/1/upload',\n          formData,\n          config\n        );\n\n        setImageUrl(response.data.data.url);\n        setLocalImageUrl(URL.createObjectURL(event.target.files[0]));\n      } catch (err) {\n        if (err?.message === 'Cancelled image upload.') return;\n\n        toast({\n          title: 'Falha no envio',\n          description: 'Ocorreu um erro ao realizar o upload da sua imagem.',\n          status: 'error',\n          duration: 5000,\n          isClosable: true,\n        });\n      } finally {\n        setIsSending(false);\n        setProgress(0);\n      }\n    },\n    [onChange, setError, setImageUrl, setLocalImageUrl, trigger, toast]\n  );\n\n  useEffect(() => {\n    if (error?.message && isSending && cancelToken?.cancel) {\n      cancelToken.cancel('Cancelled image upload.');\n      setCancelToken(null);\n    }\n  }, [cancelToken, error, isSending]);\n\n  return (\n    <FormControl isInvalid={!!error}>\n      <FormLabel\n        mx=\"auto\"\n        w={40}\n        h={40}\n        htmlFor={name}\n        cursor={isSending ? 'progress' : 'pointer'}\n        opacity={isSending ? 0.5 : 1}\n      >\n        {localImageUrl && !isSending ? (\n          <Image\n            w=\"full\"\n            h=\"full\"\n            src={localImageUrl}\n            alt=\"Uploaded photo\"\n            borderRadius=\"md\"\n            objectFit=\"cover\"\n          />\n        ) : (\n          <Flex\n            w=\"full\"\n            h=\"full\"\n            flexDir=\"column\"\n            justifyContent=\"center\"\n            alignItems=\"center\"\n            borderRadius=\"md\"\n            bgColor=\"pGray.800\"\n            color=\"pGray.200\"\n            borderWidth={error?.message && 2}\n            borderColor={error?.message && 'red.500'}\n          >\n            {isSending ? (\n              <>\n                <CircularProgress\n                  trackColor=\"pGray.200\"\n                  value={progress}\n                  color=\"orange.500\"\n                >\n                  <CircularProgressLabel>{progress}%</CircularProgressLabel>\n                </CircularProgress>\n                <Text as=\"span\" pt={2} textAlign=\"center\">\n                  Enviando...\n                </Text>\n              </>\n            ) : (\n              <Box pos=\"relative\" h=\"full\">\n                {!!error && (\n                  <Tooltip label={error.message} bg=\"red.500\">\n                    <FormErrorMessage\n                      pos=\"absolute\"\n                      right={2}\n                      top={2}\n                      mt={0}\n                      zIndex=\"tooltip\"\n                    >\n                      <Icon as={FiAlertCircle} color=\"red.500\" w={4} h={4} />\n                    </FormErrorMessage>\n                  </Tooltip>\n                )}\n\n                <Flex\n                  h=\"full\"\n                  alignItems=\"center\"\n                  justifyContent=\"center\"\n                  flexDir=\"column\"\n                >\n                  <Icon as={FiPlus} w={14} h={14} />\n                  <Text as=\"span\" pt={2} textAlign=\"center\">\n                    Adicione sua imagem\n                  </Text>\n                </Flex>\n              </Box>\n            )}\n          </Flex>\n        )}\n        <input\n          data-testid={name}\n          disabled={isSending}\n          id={name}\n          name={name}\n          onChange={handleImageUpload}\n          ref={ref}\n          type=\"file\"\n          style={{\n            display: 'none',\n          }}\n          {...rest}\n        />\n      </FormLabel>\n    </FormControl>\n  );\n};\n\nexport const FileInput = forwardRef(FileInputBase);\n"]},"metadata":{},"sourceType":"module"}